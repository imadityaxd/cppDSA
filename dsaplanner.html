<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSA Weekly Planner</title>
    <!-- 1. Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- 3. Babel to compile JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- 4. Firebase Libraries -->
    <script type="module">
        // Make Firebase imports available globally for the main script
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        window.firebase = {
            initializeApp,
            getFirestore,
            doc,
            setDoc,
            onSnapshot,
            getAuth,
            signInAnonymously,
            onAuthStateChanged,
            signInWithCustomToken
        };
    </script>
</head>
<body class="bg-gray-900">
    <!-- 5. The root element for our React app -->
    <div id="root"></div>

    <!-- 6. The React code with type="text/babel" -->
    <script type="text/babel">
        // --- Destructure React from window ---
        const { useState, useEffect, useMemo } = React;
        
        // --- Firebase setup from window ---
        const { 
            initializeApp, getFirestore, doc, setDoc, onSnapshot, 
            getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken 
        } = window.firebase;

        // --- Firebase Configuration ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-dsa-planner';

        // --- SVG Icon Components (Replaces lucide-react) ---
        const CheckCircle2 = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="m9 12 2 2 4-4"/>
            </svg>
        );
        const BookOpen = ({ size = 20, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
            </svg>
        );
        const Target = ({ size = 20, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/>
            </svg>
        );
        const ListChecks = ({ size = 20, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="m3 17 2 2 4-4"/><path d="m3 7 2 2 4-4"/><path d="M13 6h8"/><path d="M13 12h8"/><path d="M13 18h8"/>
            </svg>
        );
        const ChevronDown = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="m6 9 6 6 6-6"/>
            </svg>
        );
        const Calendar = ({ size = 14, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/>
            </svg>
        );

        // --- DSA Plan Data Generation with Dates & Subtopics ---
        const generateStudyPlanData = () => {
             const basePlan = [
                { id: 1, phase: 1, title: "Getting Started", topics: "C++/Java/Python Basics, Time/Space Complexity, Flowcharts & Pseudocode.", goal: "Solidify your chosen programming language's syntax and understand how to analyze code efficiency.", subtopics: ["C++ STL", "Java Collections", "Time & Space Complexity", "Pattern Problems"] },
                { id: 2, phase: 1, title: "Core Concepts", topics: "Basic Math (GCD, Prime Numbers), Recursion (introduction), and Hashing (theory and problems).", goal: "Understand the fundamentals of recursion and how hashmaps can optimize solutions.", subtopics: ["Basic Math", "Recursion Basics", "Hashing Theory", "Hashing Problems"] },
                { id: 3, phase: 1, title: "Sorting & Intro to Arrays", topics: "Merge Sort, Quick Sort, and other sorting algorithms. Start with 'Easy' Array problems.", goal: "Deeply understand divide-and-conquer sorting algorithms and begin applying techniques to arrays.", subtopics: ["Selection Sort", "Bubble Sort", "Insertion Sort", "Merge Sort", "Quick Sort", "Easy Array Problems"] },
                { id: 4, phase: 1, title: "Mastering Arrays", topics: "'Medium' and 'Hard' Array problems.", goal: "Develop strong problem-solving skills for the most frequently asked topic in interviews.", subtopics: ["Medium Arrays", "Hard Arrays - Part 1", "Hard Arrays - Part 2", "Kadane's Algorithm"] },
                { id: 5, phase: 2, title: "Binary Search", topics: "Binary Search on 1D & 2D arrays, and 'answer on search space.'", goal: "Learn to identify problems that can be solved with binary search, even when it's not obvious.", subtopics: ["BS on 1D Arrays", "BS on 2D Arrays", "BS on Answers"] },
                { id: 6, phase: 2, title: "Strings & Linked Lists", topics: "Basic and Medium String problems. Start with 1D Linked Lists.", goal: "Get comfortable with string manipulation and the fundamentals of pointer-based data structures.", subtopics: ["Easy Strings", "Medium Strings", "1D Linked List Basics", "DLL Basics"] },
                { id: 7, phase: 2, title: "Advanced Linked Lists", topics: "Doubly Linked Lists, Medium and Hard Linked List problems (two-pointers, cycle detection, etc.).", goal: "Master various LL patterns and complex pointer manipulations.", subtopics: ["Medium LL Problems", "Hard LL Problems", "Reverse Nodes in k-Group", "Cycle Detection"] },
                { id: 8, phase: 2, title: "Deep Dive into Recursion", topics: "Subsequences, Combination Sum, Palindrome Partitioning, and other classic backtracking problems.", goal: "Strengthen your ability to solve problems by breaking them down into smaller recursive subproblems.", subtopics: ["Subsequences", "Combination Sum", "Permutations", "N-Queens", "Sudoku Solver"] },
                { id: 9, phase: 2, title: "Stacks & Queues", topics: "Implementation and problems using Stacks and Queues (e.g., monotonic stack/queue).", goal: "Understand the LIFO and FIFO principles and their applications in solving complex problems.", subtopics: ["Stack Implementation", "Queue Implementation", "Monotonic Stack", "Monotonic Queue"] },
                { id: 10, phase: 2, title: "Two Pointers & Bit Manipulation", topics: "Problems involving sliding windows, two-pointers, and bitwise operations.", goal: "Recognize and apply these efficient patterns to optimize solutions.", subtopics: ["Sliding Window", "Two Pointers", "Bitwise Operators", "Bit Manipulation Problems"] },
                { id: 11, phase: 3, title: "Greedy Algorithms & Heaps", topics: "Classic greedy problems and Priority Queues/Heaps.", goal: "Learn to make locally optimal choices for a globally optimal solution and understand heap-based problems.", subtopics: ["Greedy Problems", "Priority Queue", "Heap Implementation", "Heap Problems"] },
                { id: 12, phase: 3, title: "Binary Trees", topics: "Traversals (Pre-order, In-order, Post-order, Level-order), Views, and construction of Binary Trees.", goal: "Build a rock-solid understanding of tree traversals, as they are the foundation for all tree problems.", subtopics: ["Traversals", "Views of BT", "LCA", "Diameter of BT", "Max Path Sum"] },
                { id: 13, phase: 3, title: "Binary Search Trees & Graphs", topics: "Properties of BSTs, searching, insertion, and deletion. Introduction to Graphs and their traversals (BFS, DFS).", goal: "Understand the advantages of BSTs and learn the fundamental graph traversal algorithms.", subtopics: ["BST Implementation", "BST Problems", "Graph Representation", "BFS", "DFS"] },
                { id: 14, phase: 3, title: "Advanced Graphs & Intro to DP", topics: "Shortest Path Algorithms (Dijkstra's), Minimum Spanning Trees, and other standard graph algorithms. Start with 1D Dynamic Programming.", goal: "Tackle classic graph algorithms and begin your journey into Dynamic Programming.", subtopics: ["Dijkstra's Algorithm", "Bellman-Ford", "Topological Sort", "1D DP Intro"] },
                { id: 15, phase: 3, title: "Dynamic Programming", topics: "2D DP, DP on Stocks, DP on Subsequences.", goal: "Practice various DP patterns. This is a challenging but vital topic.", subtopics: ["2D DP", "DP on Stocks", "DP on Subsequences", "Partition DP"] },
                { id: 16, phase: 3, title: "Final Stretch & Revision", topics: "Tries, remaining advanced topics, and most importantly, revision.", goal: "Finish the sheet and spend the final days revisiting difficult problems from each topic. Focus on your weak areas.", subtopics: ["Tries Implementation", "Tries Problems", "Advanced Graphs", "Revision"] }
            ];

            const startDate = new Date('2025-07-23T00:00:00');
            const options = { month: 'short', day: 'numeric' };

            return basePlan.map((week, index) => {
                const weekStartDate = new Date(startDate);
                weekStartDate.setDate(startDate.getDate() + (index * 7));
                const weekEndDate = new Date(weekStartDate);
                weekEndDate.setDate(weekEndDate.getDate() + 6);
                return {
                    ...week,
                    dateRange: `${weekStartDate.toLocaleDateString('en-US', options)} - ${weekEndDate.toLocaleDateString('en-US', options)}`
                };
            });
        };

        const studyPlanData = generateStudyPlanData();

        // --- Helper Components ---
        const ProgressBar = ({ value }) => (
            <div>
                <div className="flex justify-between items-center mb-1">
                    <span className="text-sm font-medium text-white">Overall Progress</span>
                    <span className="text-sm font-medium text-indigo-300">{Math.round(value)}%</span>
                </div>
                <div className="w-full bg-gray-700 rounded-full h-2.5">
                    <div className="bg-indigo-500 h-2.5 rounded-full transition-all duration-500" style={{ width: `${value}%` }}></div>
                </div>
            </div>
        );

        // --- Main App Component ---
        function App() {
            const [db, setDb] = useState(null);
            const [auth, setAuth] = useState(null);
            const [userId, setUserId] = useState(null);
            const [isAuthReady, setIsAuthReady] = useState(false);

            const [selectedWeekId, setSelectedWeekId] = useState(1);
            const [completedTopics, setCompletedTopics] = useState({});
            const [isLoading, setIsLoading] = useState(true);

            useEffect(() => {
                if (Object.keys(firebaseConfig).length > 0) {
                    const app = initializeApp(firebaseConfig);
                    const firestore = getFirestore(app);
                    const authInstance = getAuth(app);
                    setDb(firestore);
                    setAuth(authInstance);

                    const unsubscribe = onAuthStateChanged(authInstance, async (user) => {
                        if (user) {
                            setUserId(user.uid);
                        } else {
                            try {
                                const token = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                                if (token) {
                                    await signInWithCustomToken(authInstance, token);
                                } else {
                                    await signInAnonymously(authInstance);
                                }
                            } catch (error) {
                                console.error("Authentication failed:", error);
                            }
                        }
                        setIsAuthReady(true);
                    });
                    return () => unsubscribe();
                } else {
                    setIsLoading(false);
                    setIsAuthReady(true);
                }
            }, []);

            useEffect(() => {
                if (isAuthReady && db && userId) {
                    const docRef = doc(db, `artifacts/${appId}/users/${userId}/dsa_plan_progress/userProgress`);
                    const unsubscribe = onSnapshot(docRef, (docSnap) => {
                        if (docSnap.exists()) {
                            setCompletedTopics(docSnap.data().completed || {});
                        } else {
                            console.log("No progress document found.");
                        }
                        setIsLoading(false);
                    }, (error) => {
                        console.error("Error fetching progress:", error);
                        setIsLoading(false);
                    });
                    return () => unsubscribe();
                } else if (isAuthReady) {
                    setIsLoading(false);
                }
            }, [isAuthReady, db, userId]);

            const toggleTopicCompletion = async (topicId) => {
                const newCompletedStatus = { ...completedTopics, [topicId]: !completedTopics[topicId] };
                setCompletedTopics(newCompletedStatus);

                if (db && userId) {
                    try {
                        const docRef = doc(db, `artifacts/${appId}/users/${userId}/dsa_plan_progress/userProgress`);
                        await setDoc(docRef, { completed: newCompletedStatus }, { merge: true });
                    } catch (error) {
                        console.error("Error updating progress:", error);
                        setCompletedTopics(completedTopics);
                    }
                }
            };
            
            const isWeekComplete = (week) => {
                return week.subtopics.every(topic => !!completedTopics[`${week.id}-${topic}`]);
            };

            const handleWeekSelect = (weekId) => {
                setSelectedWeekId(selectedWeekId === weekId ? null : weekId);
            };
            
            const progressPercentage = useMemo(() => {
                const totalTopics = studyPlanData.reduce((acc, week) => acc + week.subtopics.length, 0);
                const completedCount = Object.values(completedTopics).filter(Boolean).length;
                return totalTopics > 0 ? (completedCount / totalTopics) * 100 : 0;
            }, [completedTopics]);

            if (isLoading) {
                return (
                    <div className="min-h-screen bg-gray-900 flex items-center justify-center text-white">
                        <svg className="animate-spin h-8 w-8 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span className="ml-3">Loading Your Plan...</span>
                    </div>
                );
            }
            
            return (
                <div className="min-h-screen font-sans bg-gray-900 text-white p-4 sm:p-6 lg:p-8">
                    <div className="max-w-4xl mx-auto">
                        <header className="mb-8 text-center">
                            <h1 className="text-3xl sm:text-4xl font-bold text-white tracking-tight">Strivers A2Z DSA Plan</h1>
                            <p className="text-gray-400 mt-2">Your interactive 16-week roadmap to mastering Data Structures & Algorithms.</p>
                        </header>

                        <div className="mb-8 p-4 bg-gray-800 rounded-xl">
                            <ProgressBar value={progressPercentage} />
                        </div>

                        <div className="space-y-3">
                            {studyPlanData.map((week) => {
                                const isSelected = selectedWeekId === week.id;
                                const weekIsComplete = isWeekComplete(week);
                                return (
                                    <div key={week.id} className="bg-gray-800 rounded-lg overflow-hidden transition-all duration-300">
                                        <button
                                            onClick={() => handleWeekSelect(week.id)}
                                            className="w-full flex items-center justify-between p-4 text-left"
                                        >
                                            <div className="flex items-center flex-grow min-w-0">
                                                <div className="mr-4 flex-shrink-0">
                                                    <CheckCircle2 className={`h-6 w-6 transition-colors ${weekIsComplete ? 'text-green-400' : 'text-gray-500'}`} />
                                                </div>
                                                <div className="flex-grow min-w-0">
                                                    <span className="font-medium text-white block truncate">Week {week.id}: {week.title}</span>
                                                    <div className="flex items-center text-xs text-indigo-300 mt-1">
                                                        <Calendar className="mr-1.5" />
                                                        <span>{week.dateRange}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <ChevronDown className={`h-5 w-5 text-gray-400 transition-transform duration-300 ml-4 flex-shrink-0 ${isSelected ? 'rotate-180' : ''}`} />
                                        </button>
                                        <div className={`grid transition-all duration-500 ease-in-out ${isSelected ? 'grid-rows-[1fr] opacity-100' : 'grid-rows-[0fr] opacity-0'}`}>
                                            <div className="overflow-hidden">
                                                <div className="border-t border-gray-700 p-4 sm:p-6">
                                                    <h3 className="text-md font-semibold text-indigo-200 mb-3">Topics to Cover</h3>
                                                    <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3">
                                                        {week.subtopics.map(topic => {
                                                            const topicId = `${week.id}-${topic}`;
                                                            const isCompleted = !!completedTopics[topicId];
                                                            return (
                                                                <button
                                                                    key={topicId}
                                                                    onClick={() => toggleTopicCompletion(topicId)}
                                                                    className={`p-3 rounded-lg text-sm font-medium transition-all duration-200 text-center ${isCompleted ? 'bg-green-500/80 text-white' : 'bg-gray-700/50 hover:bg-gray-700 text-gray-300'}`}
                                                                >
                                                                    {topic}
                                                                </button>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        <footer className="text-center text-gray-500 mt-12 text-sm">
                            <p>Good luck with your preparation! Consistency is key.</p>
                        </footer>
                    </div>
                </div>
            );
        }

        // --- 8. Render the App ---
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);

    </script>
</body>
</html>
